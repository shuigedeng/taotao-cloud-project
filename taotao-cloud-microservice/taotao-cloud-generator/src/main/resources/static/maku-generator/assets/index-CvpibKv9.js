import{d as Q,r as S,a as T,b as o,o as h,c as D,w as a,e,f as _,A as q,D as $,G as O,E as x,z as M,v as g,B,i as A,H as P}from"./index-BiRPmL5w.js";import{b as K,c as j,d as E}from"./datasource-QXijzE4a.js";import{u as G}from"./index-D6a9aOBY.js";const I=Q({__name:"add-or-update",emits:["refreshDataList"],setup(z,{expose:r,emit:V}){const v=V,m=S(!1),c=S(),t=T({id:"",dbType:"",connName:"",connUrl:"",username:"",password:""}),L=s=>{m.value=!0,t.id="",c.value&&c.value.resetFields(),s&&U(s)},U=s=>{K(s).then(l=>{l.data.password=$(l.data.password),Object.assign(t,l.data)})},y=S({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connUrl:[{required:!0,message:"必填项不能为空",trigger:"blur"}],username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],password:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),C=()=>{c.value.validate(s=>{if(!s)return!1;j({...t,password:O(t.password)}).then(()=>{x.success({message:"操作成功",duration:500,onClose:()=>{m.value=!1,v("refreshDataList")}})})})};return r({init:L}),(s,l)=>{const b=o("el-input"),i=o("el-form-item"),d=o("el-option"),k=o("el-select"),f=o("el-form"),w=o("el-button"),p=o("el-dialog");return h(),D(p,{modelValue:m.value,"onUpdate:modelValue":l[8]||(l[8]=n=>m.value=n),title:t.id?"修改":"新增","close-on-click-modal":!1},{footer:a(()=>[e(w,{onClick:l[6]||(l[6]=n=>m.value=!1)},{default:a(()=>[_("取消")]),_:1}),e(w,{type:"primary",onClick:l[7]||(l[7]=n=>C())},{default:a(()=>[_("确定")]),_:1})]),default:a(()=>[e(f,{ref_key:"dataFormRef",ref:c,model:t,rules:y.value,"label-width":"120px",onKeyup:l[5]||(l[5]=q(n=>C(),["enter"]))},{default:a(()=>[e(i,{label:"连接名",prop:"connName"},{default:a(()=>[e(b,{modelValue:t.connName,"onUpdate:modelValue":l[0]||(l[0]=n=>t.connName=n),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(i,{prop:"dbType",label:"数据库类型"},{default:a(()=>[e(k,{modelValue:t.dbType,"onUpdate:modelValue":l[1]||(l[1]=n=>t.dbType=n),clearable:"",placeholder:"数据库类型",style:{width:"100%"}},{default:a(()=>[e(d,{value:"MySQL",label:"MySQL"}),e(d,{value:"Oracle",label:"Oracle"}),e(d,{value:"PostgreSQL",label:"PostgreSQL"}),e(d,{value:"SQLServer",label:"SQLServer"}),e(d,{value:"DM",label:"达梦8"}),e(d,{value:"KingBase",label:"人大金仓"}),e(d,{value:"Clickhouse",label:"Clickhouse"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"数据库URL",prop:"connUrl"},{default:a(()=>[e(b,{modelValue:t.connUrl,"onUpdate:modelValue":l[2]||(l[2]=n=>t.connUrl=n),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),e(i,{label:"用户名",prop:"username"},{default:a(()=>[e(b,{modelValue:t.username,"onUpdate:modelValue":l[3]||(l[3]=n=>t.username=n),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),e(i,{label:"密码",prop:"password"},{default:a(()=>[e(b,{modelValue:t.password,"onUpdate:modelValue":l[4]||(l[4]=n=>t.password=n),autocomplete:"off",type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Y=Q({__name:"index",setup(z){const r=T({dataListUrl:"/gen/datasource/page",deleteUrl:"/gen/datasource",queryForm:{connName:"",dbType:""}}),V=s=>{E(s).then(l=>{x.success(l.data)})},v=S(),m=s=>{v.value.init(s)},{getDataList:c,selectionChangeHandle:t,sizeChangeHandle:L,currentChangeHandle:U,deleteBatchHandle:y}=G(r),C=s=>Array($(s).length).fill("•").join("");return(s,l)=>{const b=o("el-input"),i=o("el-form-item"),d=o("el-option"),k=o("el-select"),f=o("el-button"),w=o("el-form"),p=o("el-table-column"),n=o("el-table"),F=o("el-pagination"),R=o("el-card"),H=M("loading");return h(),D(R,null,{default:a(()=>[e(w,{inline:!0,model:r.queryForm,onKeyup:l[5]||(l[5]=q(u=>g(c)(),["enter"]))},{default:a(()=>[e(i,null,{default:a(()=>[e(b,{modelValue:r.queryForm.connName,"onUpdate:modelValue":l[0]||(l[0]=u=>r.queryForm.connName=u),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(i,{prop:"dbType"},{default:a(()=>[e(k,{modelValue:r.queryForm.dbType,"onUpdate:modelValue":l[1]||(l[1]=u=>r.queryForm.dbType=u),clearable:"",placeholder:"数据库类型"},{default:a(()=>[e(d,{value:"MySQL",label:"MySQL"}),e(d,{value:"Oracle",label:"Oracle"}),e(d,{value:"PostgreSQL",label:"PostgreSQL"}),e(d,{value:"SQLServer",label:"SQLServer"}),e(d,{value:"DM",label:"达梦8"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(f,{onClick:l[2]||(l[2]=u=>g(c)())},{default:a(()=>[_("查询")]),_:1})]),_:1}),e(i,null,{default:a(()=>[e(f,{type:"primary",onClick:l[3]||(l[3]=u=>m())},{default:a(()=>[_("新增")]),_:1})]),_:1}),e(i,null,{default:a(()=>[e(f,{type:"danger",onClick:l[4]||(l[4]=u=>g(y)())},{default:a(()=>[_("删除")]),_:1})]),_:1})]),_:1},8,["model"]),B((h(),D(n,{data:r.dataList,border:"",style:{width:"100%"},onSelectionChange:g(t)},{default:a(()=>[e(p,{type:"selection","header-align":"center",align:"center",width:"50"}),e(p,{prop:"connName",label:"连接名","header-align":"center",align:"center"}),e(p,{prop:"dbType",label:"数据库类型","header-align":"center",align:"center"}),e(p,{prop:"connUrl",label:"数据库URL","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(p,{prop:"username",label:"用户名","header-align":"center",align:"center"}),e(p,{label:"密码","header-align":"center",align:"center"},{default:a(u=>[A("span",null,P(C(u.row.password)),1)]),_:1}),e(p,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:a(u=>[e(f,{type:"primary",link:"",onClick:N=>V(u.row.id)},{default:a(()=>[_("测试")]),_:2},1032,["onClick"]),e(f,{type:"primary",link:"",onClick:N=>m(u.row.id)},{default:a(()=>[_("编辑")]),_:2},1032,["onClick"]),e(f,{type:"primary",link:"",onClick:N=>g(y)(u.row.id)},{default:a(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[H,r.dataListLoading]]),e(F,{"current-page":r.page,"page-sizes":r.pageSizes,"page-size":r.limit,total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g(L),onCurrentChange:g(U)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"]),e(I,{ref_key:"addOrUpdateRef",ref:v,onRefreshDataList:g(c)},null,8,["onRefreshDataList"])]),_:1})}}});export{Y as default};
